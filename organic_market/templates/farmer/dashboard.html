{% extends 'farmer/farmer_base.html' %}
{% block content %}

<div class="container mt-4">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="text-success fw-bold"> üë®‚Äçüåæ Farmer Dashboard</h3>
    <h3 class="mb-4">Welcome, {{ request.user.username }} üëã</h3>
    <a href="{% url 'add_product' %}" class="btn btn-success">
      ‚ûï Add Product
    </a>
  </div>

  <!-- VERIFICATION ALERT -->
 {% if not farmer.is_verified %}
<div class="alert alert-warning text-center">
  ‚è≥ Your account is pending admin verification.
  You can view dashboard but cannot add products yet.
</div>
{% endif %}

  <!-- DASHBOARD STATS -->
  <div class="row mb-4">

    <div class="col-md-3">
      <div class="card shadow-sm text-center p-3">
        <h6>Total Products</h6>
        <h2 class="text-success">{{ total_products }}</h2>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm text-center p-3">
        <h6>Total Orders</h6>
        <h2 class="text-primary">{{ total_orders }}</h2>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm text-center p-3">
        <h6>Total Revenue</h6>
        <h2 class="text-dark">‚Çπ {{ revenue }}</h2>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm text-center p-3 bg-warning">
        <h6>Low Stock Alerts</h6>
        <h2>{{ low_stock.count }}</h2>
      </div>
    </div>

  </div>
  <!-- LOW STOCK ALERTS -->
  {% if low_stock %}
  <div class="alert alert-danger">
    <strong>‚ö† Low Stock Products:</strong>
    <ul class="mb-0">
      {% for p in low_stock %}
        <li>{{ p.name }} ({{ p.stock }} left)</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- PRODUCTS SECTION -->
  <h4 class="mb-3">üì¶ Your Products</h4>

  {% if products %}
  <div class="row g-4">
    {% for product in products %}
    <div class="col-md-4">
      <div class="card shadow-sm h-100">

        {% if product.image %}
        <img src="{{ product.image.url }}" class="card-img-top"
             style="height:200px; object-fit:cover;">
        {% endif %}

        <div class="card-body">
          <h5 class="card-title">{{ product.name }}</h5>

          <p class="text-muted mb-1">
            Harvest: {{ product.harvest_date|default:"N/A" }}
          </p>

          <p class="text-muted mb-1">
            Expiry: {{ product.expiry_date|default:"N/A" }}
          </p>

          <p class="fw-bold text-success">‚Çπ {{ product.price }}</p>

          {% if product.is_approved %}
            <span class="badge bg-success">Approved</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pending Admin Approval</span>
          {% endif %}

          <span class="badge bg-info">
            Stock: {{ product.stock }}
          </span>

          <div class="mt-3 d-flex gap-2">
            <a href="{% url 'edit_product' product.id %}" class="btn btn-outline-success btn-sm">Edit</a>
            <a href="{% url 'delete_product' product.id %}" class="btn btn-outline-danger btn-sm">Delete</a>
          </div>
        </div>

      </div>
    </div>
    {% endfor %}
  </div>

  {% if page_obj.paginator.num_pages > 1 %}
    <nav class="mt-4" aria-label="Products pagination">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
        </li>

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}

  {% else %}
  <div class="alert alert-warning text-center mt-4">
    No products added yet. Click <b>Add Product</b> to get started!
  </div>
  {% endif %}

</div>

{% endblock %}
